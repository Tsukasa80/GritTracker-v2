<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GritTracker - 粘り力を可視化する</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 緑・黒系統配色 */
        :root {
            --color-green: #22c55e;
            --color-green-light: #4ade80;
            --color-green-dark: #16a34a;
            --color-black: #1f2937;
            --color-gray-dark: #374151;
        }
        
        /* スライダーのカスタムスタイル */
        input[type="range"].slider {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            cursor: pointer;
        }
        
        /* WebKit (Chrome, Safari, Edge) */
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none !important;
            appearance: none !important;
            height: 24px !important;
            width: 24px !important;
            border-radius: 50% !important;
            background: linear-gradient(45deg, #22c55e, #1f2937) !important;
            cursor: pointer !important;
            border: 2px solid #ffffff !important;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2) !important;
            transition: all 0.2s ease !important;
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1) !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
        }
        
        /* Firefox */
        .slider::-moz-range-thumb {
            height: 24px !important;
            width: 24px !important;
            border-radius: 50% !important;
            background: linear-gradient(45deg, #22c55e, #1f2937) !important;
            cursor: pointer !important;
            border: 2px solid #ffffff !important;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2) !important;
        }
        
        /* スライダートラック */
        .slider::-webkit-slider-track {
            height: 12px !important;
            border-radius: 6px !important;
            background: linear-gradient(to right, #22c55e, #4ade80, #1f2937) !important;
        }
        
        .slider::-moz-range-track {
            height: 12px !important;
            border-radius: 6px !important;
            background: linear-gradient(to right, #22c55e, #4ade80, #1f2937) !important;
            border: none !important;
        }
        
        /* カスタムクラス */
        .bg-grit-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #f0fff4 30%, #22c55e 100%);
        }
        
        .btn-grit {
            background: linear-gradient(135deg, #22c55e, #1f2937);
            transition: all 0.2s ease;
        }
        
        .btn-grit:hover {
            background: linear-gradient(135deg, #16a34a, #374151);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }
        
        .text-grit-gradient {
            background: linear-gradient(135deg, #22c55e, #1f2937);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .text-grit-primary { color: #22c55e; }
        .text-grit-secondary { color: #1f2937; }
        .bg-grit-primary { background-color: #22c55e; }
        .bg-grit-secondary { background-color: #1f2937; }
        .border-grit-primary { border-color: #22c55e; }
        .border-grit-secondary { border-color: #1f2937; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ユーティリティ関数
        const generateId = () => `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        
        const formatDate = (date) => date.toISOString().split('T')[0];
        
        const getTodayDate = () => formatDate(new Date());
        
        const getWeekStartDate = (date) => {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1);
            const monday = new Date(d.setDate(diff));
            return formatDate(monday);
        };
        
        const getWeekEndDate = (date) => {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? 0 : 7);
            const sunday = new Date(d.setDate(diff));
            return formatDate(sunday);
        };
        
        const calculateEnduranceScore = (difficultyScore, enduredTime) => difficultyScore * enduredTime;
        
        const getLogsForWeek = (logs, weekStartDate) => {
            const startDate = new Date(weekStartDate);
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 6);
            
            return logs.filter(log => {
                const logDate = new Date(log.date);
                return logDate >= startDate && logDate <= endDate;
            });
        };
        
        const formatTimeFromMinutes = (minutes) => {
            if (minutes < 60) return `${minutes}分`;
            const hours = Math.floor(minutes / 60);
            const remainingMinutes = minutes % 60;
            return remainingMinutes === 0 ? `${hours}時間` : `${hours}時間${remainingMinutes}分`;
        };

        // メインアプリケーション
        function App() {
            // 状態管理
            const [currentView, setCurrentView] = React.useState('dashboard');
            const [gritLogs, setGritLogs] = React.useState([]);
            const [weeklyReviews, setWeeklyReviews] = React.useState([]);
            const [rewardSettings, setRewardSettings] = React.useState([]);
            const [isMobileMenuOpen, setIsMobileMenuOpen] = React.useState(false);

            // LocalStorageからデータを読み込み
            React.useEffect(() => {
                const savedData = localStorage.getItem('grit-tracker-storage');
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        if (data.state) {
                            setGritLogs(data.state.gritLogs || []);
                            setWeeklyReviews(data.state.weeklyReviews || []);
                            setRewardSettings(data.state.rewardSettings || []);
                        }
                    } catch (e) {
                        console.log('データ読み込みエラー:', e);
                    }
                }
            }, []);

            // データを保存
            const saveToStorage = React.useCallback((newGritLogs, newWeeklyReviews, newRewardSettings) => {
                const data = {
                    state: {
                        gritLogs: newGritLogs || gritLogs,
                        weeklyReviews: newWeeklyReviews || weeklyReviews,
                        rewardSettings: newRewardSettings || rewardSettings,
                    },
                    version: 0
                };
                localStorage.setItem('grit-tracker-storage', JSON.stringify(data));
            }, [gritLogs, weeklyReviews, rewardSettings]);

            // GritLog追加
            const addGritLog = (logData) => {
                const newLog = {
                    id: generateId(),
                    enduranceScore: calculateEnduranceScore(logData.difficultyScore, logData.enduredTime),
                    createdAt: new Date().toISOString(),
                    ...logData,
                };
                
                const newGritLogs = [...gritLogs, newLog];
                setGritLogs(newGritLogs);
                saveToStorage(newGritLogs, weeklyReviews, rewardSettings);
                checkAndCompleteRewards(newGritLogs);
            };

            // 週次レビュー保存
            const saveWeeklyReview = (reviewData) => {
                const newReview = {
                    id: generateId(),
                    createdAt: new Date().toISOString(),
                    ...reviewData,
                };
                
                const existingIndex = weeklyReviews.findIndex(
                    review => review.weekStartDate === newReview.weekStartDate
                );
                
                let newWeeklyReviews;
                if (existingIndex >= 0) {
                    newWeeklyReviews = [...weeklyReviews];
                    newWeeklyReviews[existingIndex] = newReview;
                } else {
                    newWeeklyReviews = [...weeklyReviews, newReview];
                }
                
                setWeeklyReviews(newWeeklyReviews);
                saveToStorage(gritLogs, newWeeklyReviews, rewardSettings);
            };

            // ご褒美追加
            const addRewardSetting = (rewardData) => {
                const newReward = {
                    id: generateId(),
                    isCompleted: false,
                    createdAt: new Date().toISOString(),
                    ...rewardData,
                };
                
                const newRewardSettings = [...rewardSettings, newReward];
                setRewardSettings(newRewardSettings);
                saveToStorage(gritLogs, weeklyReviews, newRewardSettings);
            };

            // ご褒美更新
            const updateRewardSetting = (id, updates) => {
                const newRewardSettings = rewardSettings.map(reward =>
                    reward.id === id ? { ...reward, ...updates } : reward
                );
                setRewardSettings(newRewardSettings);
                saveToStorage(gritLogs, weeklyReviews, newRewardSettings);
            };

            // ご褒美削除
            const deleteRewardSetting = (id) => {
                const newRewardSettings = rewardSettings.filter(reward => reward.id !== id);
                setRewardSettings(newRewardSettings);
                saveToStorage(gritLogs, weeklyReviews, newRewardSettings);
            };

            // ご褒美チェック
            const checkAndCompleteRewards = (logs = gritLogs) => {
                const cumulativeScore = logs.reduce((total, log) => total + log.enduranceScore, 0);
                
                const updatedRewards = rewardSettings.map(reward => {
                    if (!reward.isCompleted && cumulativeScore >= reward.targetScore) {
                        return { ...reward, isCompleted: true, completedAt: new Date().toISOString() };
                    }
                    return reward;
                });
                
                setRewardSettings(updatedRewards);
                saveToStorage(logs, weeklyReviews, updatedRewards);
            };

            // 統計計算
            const getWeeklyTotalScore = () => {
                const today = new Date();
                const thisWeekStart = getWeekStartDate(today);
                const weekLogs = getLogsForWeek(gritLogs, thisWeekStart);
                return weekLogs.reduce((total, log) => total + log.enduranceScore, 0);
            };

            const getCumulativeTotalScore = () => {
                return gritLogs.reduce((total, log) => total + log.enduranceScore, 0);
            };

            const getWeeklyReview = (weekStartDate) => {
                return weeklyReviews.find(review => review.weekStartDate === weekStartDate) || null;
            };

            // ナビゲーション項目
            const navigationItems = [
                { key: 'dashboard', label: 'ダッシュボード', icon: '📊', description: '成果を可視化' },
                { key: 'record', label: '記録する', icon: '✏️', description: '粘りを記録' },
                { key: 'review', label: '振り返り', icon: '📋', description: '週次レビュー' },
                { key: 'rewards', label: 'ご褒美', icon: '🎁', description: 'モチベーション' },
            ];

            // ダッシュボードコンポーネント
            const Dashboard = () => {
                const weeklyTotalScore = getWeeklyTotalScore();
                const cumulativeTotalScore = getCumulativeTotalScore();
                
                const recentLogs = React.useMemo(() => {
                    return [...gritLogs]
                        .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())
                        .slice(0, 5);
                }, [gritLogs]);

                const nextReward = React.useMemo(() => {
                    return rewardSettings
                        .filter(reward => !reward.isCompleted)
                        .sort((a, b) => a.targetScore - b.targetScore)[0];
                }, [rewardSettings]);

                const rewardProgress = nextReward ? Math.min((cumulativeTotalScore / nextReward.targetScore) * 100, 100) : 0;

                return (
                    <div className="bg-grit-gradient p-8 min-h-screen">
                        <div className="max-w-6xl mx-auto space-y-8">
                            {/* ヘッダー */}
                            <div className="text-center py-8">
                                <div className="text-6xl mb-4">🏆</div>
                                <h1 className="text-4xl font-bold text-grit-gradient mb-3 drop-shadow-lg">
                                    GritTracker<br/>ダッシュボード
                                </h1>
                                <p className="text-gray-600 text-lg">あなたの粘り力を可視化して、成長を実感しましょう</p>
                            </div>

                            {/* メインスタッツ */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                {/* 今週の合計耐久スコア */}
                                <div className="bg-white/95 backdrop-blur-sm p-8 rounded-2xl shadow-2xl">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <h3 className="text-lg font-semibold text-gray-800 mb-2">今週の合計耐久スコア</h3>
                                            <p className="text-4xl font-bold text-grit-primary">{weeklyTotalScore.toLocaleString()}</p>
                                            <p className="text-gray-600 text-sm">ポイント</p>
                                        </div>
                                        <div className="text-4xl">🔥</div>
                                    </div>
                                </div>

                                {/* 累計耐久スコア */}
                                <div className="bg-white/95 backdrop-blur-sm p-8 rounded-2xl shadow-2xl">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <h3 className="text-lg font-semibold text-gray-800 mb-2">累計耐久スコア</h3>
                                            <p className="text-4xl font-bold text-grit-secondary">{cumulativeTotalScore.toLocaleString()}</p>
                                            <p className="text-gray-600 text-sm">総ポイント</p>
                                        </div>
                                        <div className="text-4xl">🏆</div>
                                    </div>
                                </div>
                            </div>

                            {/* ご褒美進捗 */}
                            {nextReward && (
                                <div className="bg-white/95 backdrop-blur-sm p-8 rounded-2xl shadow-2xl">
                                    <div className="flex items-center justify-between mb-6">
                                        <div>
                                            <h3 className="text-2xl font-bold text-gray-800">次のご褒美まで</h3>
                                            <p className="text-gray-600 font-medium">{nextReward.rewardContent}</p>
                                        </div>
                                        <div className="text-right">
                                            <p className="text-2xl font-bold text-gray-700">{rewardProgress.toFixed(1)}%</p>
                                            <p className="text-gray-600 text-sm">完了</p>
                                        </div>
                                    </div>
                                    
                                    <div className="mb-4">
                                        <div className="flex justify-between text-sm font-semibold text-gray-700 mb-3">
                                            <span>現在のスコア</span>
                                            <span>{cumulativeTotalScore.toLocaleString()} / {nextReward.targetScore.toLocaleString()}</span>
                                        </div>
                                        <div className="w-full bg-gray-200 rounded-full h-6 overflow-hidden">
                                            <div 
                                                className="h-full bg-grit-gradient rounded-full transition-all duration-700"
                                                style={{ width: `${rewardProgress}%` }}
                                            />
                                        </div>
                                    </div>
                                    
                                    {rewardProgress >= 100 && (
                                        <div className="text-center py-4 bg-green-50 rounded-2xl border border-green-200">
                                            <span className="text-3xl mb-2 block">🎉</span>
                                            <span className="text-xl font-bold text-green-800">おめでとうございます！</span>
                                            <p className="text-green-600 mt-1">ご褒美をゲットしました！</p>
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* 最近の記録 */}
                            <div className="bg-white/95 backdrop-blur-sm p-8 rounded-2xl shadow-2xl">
                                <h3 className="text-2xl font-bold text-gray-800 mb-8 flex items-center">
                                    <span className="mr-3">🕒</span>最近の記録
                                </h3>
                                
                                {recentLogs.length === 0 ? (
                                    <div className="text-center py-12">
                                        <div className="text-6xl mb-4">📝</div>
                                        <p className="text-xl font-semibold text-gray-700 mb-3">まだ記録がありません</p>
                                        <p className="text-gray-600">「記録する」から最初の粘り記録を作成しましょう！</p>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        {recentLogs.map((log) => (
                                            <div key={log.id} className="border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-all">
                                                <div className="flex justify-between items-start">
                                                    <div className="flex-1">
                                                        <h4 className="font-bold text-gray-800 text-lg mb-2">{log.taskName}</h4>
                                                        <div className="flex items-center space-x-6 text-sm text-gray-600 mb-3">
                                                            <span>📅 {log.date}</span>
                                                            <span>⏱️ {log.enduredTime}分</span>
                                                            <span className="bg-green-100 text-green-700 px-3 py-1 rounded-full font-semibold">
                                                                苦しさ: {log.difficultyScore}/10
                                                            </span>
                                                        </div>
                                                        {log.details && (
                                                            <p className="text-gray-700 italic bg-gray-50 p-3 rounded-lg">
                                                                "{log.details}"
                                                            </p>
                                                        )}
                                                    </div>
                                                    <div className="bg-gradient-to-br from-green-500 to-gray-800 text-white w-16 h-16 rounded-xl flex items-center justify-center shadow-lg ml-4">
                                                        <div className="text-center">
                                                            <div className="text-lg font-bold">{log.enduranceScore}</div>
                                                            <div className="text-xs opacity-90">pt</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>

                            {/* データ管理 */}
                            <div className="bg-white/95 backdrop-blur-sm p-8 rounded-2xl shadow-2xl">
                                <h3 className="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                                    <span className="mr-3">💾</span>データ管理
                                </h3>
                                <p className="text-gray-600 mb-6">スマホとPCでデータを共有できます</p>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {/* エクスポート */}
                                    <div className="bg-blue-50 p-6 rounded-xl border border-blue-200">
                                        <h4 className="font-bold text-gray-800 mb-3 flex items-center">
                                            <span className="mr-2">📤</span>データをエクスポート
                                        </h4>
                                        <p className="text-sm text-gray-600 mb-4">現在のデータを他の端末に移行できます</p>
                                        <button
                                            onClick={() => {
                                                const data = localStorage.getItem('grit-tracker-storage');
                                                if (data) {
                                                    navigator.clipboard.writeText(data).then(() => {
                                                        alert('✅ データをクリップボードにコピーしました！\n\n📱 他の端末で「データをインポート」に貼り付けてください。');
                                                    }).catch(() => {
                                                        const textarea = document.createElement('textarea');
                                                        textarea.value = data;
                                                        document.body.appendChild(textarea);
                                                        textarea.select();
                                                        document.execCommand('copy');
                                                        document.body.removeChild(textarea);
                                                        alert('✅ データをクリップボードにコピーしました！\n\n📱 他の端末で「データをインポート」に貼り付けてください。');
                                                    });
                                                } else {
                                                    alert('❌ エクスポートするデータがありません。');
                                                }
                                            }}
                                            className="w-full bg-blue-500 text-white px-4 py-3 rounded-xl hover:bg-blue-600 transition-colors font-semibold flex items-center justify-center space-x-2"
                                        >
                                            <span>📤</span>
                                            <span>データをコピー</span>
                                        </button>
                                    </div>

                                    {/* インポート */}
                                    <div className="bg-green-50 p-6 rounded-xl border border-green-200">
                                        <h4 className="font-bold text-gray-800 mb-3 flex items-center">
                                            <span className="mr-2">📥</span>データをインポート
                                        </h4>
                                        <p className="text-sm text-gray-600 mb-4">他の端末からデータを読み込みます</p>
                                        <button
                                            onClick={() => {
                                                const importData = prompt('📥 エクスポートしたデータを貼り付けてください:\n\n⚠️ 現在のデータは上書きされます。');
                                                if (importData) {
                                                    try {
                                                        JSON.parse(importData);
                                                        localStorage.setItem('grit-tracker-storage', importData);
                                                        alert('✅ データのインポートが完了しました！\n\n🔄 ページを再読み込みします。');
                                                        window.location.reload();
                                                    } catch (e) {
                                                        alert('❌ データ形式が正しくありません。\n\n正しいエクスポートデータを貼り付けてください。');
                                                    }
                                                }
                                            }}
                                            className="w-full bg-green-500 text-white px-4 py-3 rounded-xl hover:bg-green-600 transition-colors font-semibold flex items-center justify-center space-x-2"
                                        >
                                            <span>📥</span>
                                            <span>データを読み込み</span>
                                        </button>
                                    </div>
                                </div>

                                {/* 使い方説明 */}
                                <div className="mt-6 bg-yellow-50 p-4 rounded-xl border border-yellow-200">
                                    <h5 className="font-bold text-gray-800 mb-2 flex items-center">
                                        <span className="mr-2">💡</span>使い方
                                    </h5>
                                    <ol className="text-sm text-gray-700 space-y-1 pl-4">
                                        <li>1. 📱 PC側で「データをコピー」をクリック</li>
                                        <li>2. 📨 LINEやメールで自分に送信</li>
                                        <li>3. 📱 スマホで受信して「データを読み込み」に貼り付け</li>
                                    </ol>
                                </div>
                            </div>

                            {/* 励ましメッセージ */}
                            <div className="bg-white/95 backdrop-blur-sm p-8 rounded-2xl text-center shadow-2xl">
                                <div className="text-4xl mb-4">💪</div>
                                <h3 className="text-2xl font-bold text-gray-800 mb-4">
                                    {cumulativeTotalScore === 0 ? 
                                        '最初の一歩を踏み出そう！' : 
                                        cumulativeTotalScore > 1000 ? 
                                        '素晴らしい粘り力です！継続は力なり！' :
                                        '着実に成長しています！この調子で頑張りましょう！'
                                    }
                                </h3>
                                <p className="text-gray-700 text-lg leading-relaxed">
                                    {cumulativeTotalScore === 0 ?
                                        '小さな困難でも記録することから始めましょう。あなたの成長が見える化されます。' :
                                        '毎日の小さな「粘り」が、大きな成果につながっています。自分を信じて続けていきましょう！'
                                    }
                                </p>
                            </div>
                        </div>
                    </div>
                );
            };

            // クイック記録コンポーネント
            const QuickRecord = () => {
                const [formData, setFormData] = React.useState({
                    date: getTodayDate(),
                    taskName: '',
                    difficultyScore: 5,
                    enduredTime: 0,
                    details: '',
                    wasSuccessful: undefined,
                });

                const handleSubmit = (e) => {
                    e.preventDefault();
                    
                    if (!formData.taskName.trim() || formData.enduredTime <= 0) {
                        alert('タスク名と粘った時間を入力してください！');
                        return;
                    }

                    addGritLog(formData);
                    
                    setFormData({
                        date: getTodayDate(),
                        taskName: '',
                        difficultyScore: 5,
                        enduredTime: 0,
                        details: '',
                        wasSuccessful: undefined,
                    });
                    
                    alert('記録を保存しました！🎉 お疲れさまでした！');
                };

                const enduranceScore = calculateEnduranceScore(formData.difficultyScore, formData.enduredTime);

                return (
                    <div className="bg-grit-gradient p-8 min-h-screen">
                        <div className="max-w-4xl mx-auto">
                            {/* ヘッダー */}
                            <div className="text-center py-8">
                                <div className="text-6xl mb-4">✏️</div>
                                <h1 className="text-4xl font-bold text-grit-gradient mb-3 drop-shadow-lg">粘り記録を作成</h1>
                                <p className="text-gray-600 text-lg">苦しさを成長の証に変えましょう</p>
                            </div>

                            {/* フォーム */}
                            <form onSubmit={handleSubmit} className="bg-white/95 backdrop-blur-sm p-8 rounded-2xl shadow-2xl space-y-6">
                                {/* 日付とタスク名 */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label className="block text-sm font-bold text-gray-800 mb-2">日付</label>
                                        <input
                                            type="date"
                                            value={formData.date}
                                            onChange={(e) => setFormData({ ...formData, date: e.target.value })}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-grit-primary focus:outline-none transition-colors"
                                            required
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-bold text-gray-800 mb-2">
                                            何に粘りましたか？ <span className="text-red-500">*</span>
                                        </label>
                                        <input
                                            type="text"
                                            value={formData.taskName}
                                            onChange={(e) => setFormData({ ...formData, taskName: e.target.value })}
                                            placeholder="例：数学の勉強、筋トレ、英語学習など"
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-grit-primary focus:outline-none transition-colors"
                                            required
                                        />
                                    </div>
                                </div>

                                {/* 苦しさスコア */}
                                <div>
                                    <label className="block text-sm font-bold text-gray-800 mb-2">
                                        📊 苦しさレベル: <span className="text-grit-primary font-bold ml-2">{formData.difficultyScore}/10</span>
                                    </label>
                                    <input
                                        type="range"
                                        min="1"
                                        max="10"
                                        value={formData.difficultyScore}
                                        onChange={(e) => setFormData({ ...formData, difficultyScore: parseInt(e.target.value) })}
                                        className="w-full h-3 rounded-lg cursor-pointer slider"
                                        style={{
                                            background: 'linear-gradient(to right, #22c55e, #4ade80, #1f2937)'
                                        }}
                                    />
                                    <div className="flex justify-between text-xs text-gray-600 font-medium mt-1">
                                        <span>1 (楽勝)</span>
                                        <span>5 (普通)</span>
                                        <span>10 (激しい)</span>
                                    </div>
                                </div>

                                {/* 粘った時間 */}
                                <div>
                                    <label className="block text-sm font-bold text-gray-800 mb-2">
                                        ⏱️ 頑張った時間（分） <span className="text-red-500">*</span>
                                    </label>
                                    <input
                                        type="number"
                                        min="1"
                                        max="480"
                                        value={formData.enduredTime || ''}
                                        onChange={(e) => setFormData({ ...formData, enduredTime: parseInt(e.target.value) || 0 })}
                                        placeholder="分数を入力"
                                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-grit-primary focus:outline-none transition-colors"
                                        required
                                    />
                                </div>

                                {/* 耐久スコア表示 */}
                                {formData.enduredTime > 0 && (
                                    <div className="bg-green-50 p-6 rounded-xl border border-green-200 text-center">
                                        <div className="text-2xl mb-2">📊</div>
                                        <h3 className="text-xl font-bold text-gray-800 mb-2">予想獲得ポイント</h3>
                                        <div className="text-4xl font-extrabold text-grit-primary mb-2">
                                            {enduranceScore}
                                        </div>
                                        <p className="text-sm text-gray-600">
                                            苦しさ {formData.difficultyScore} × 時間 {formData.enduredTime}分 = {enduranceScore}ポイント
                                        </p>
                                    </div>
                                )}

                                {/* 完了状況 */}
                                <div>
                                    <label className="block text-sm font-bold text-gray-800 mb-3">
                                        ⭐ 結果はどうでしたか？
                                    </label>
                                    <div className="flex space-x-4">
                                        <label className="flex items-center space-x-2 cursor-pointer">
                                            <input
                                                type="radio"
                                                name="wasSuccessful"
                                                checked={formData.wasSuccessful === true}
                                                onChange={() => setFormData({ ...formData, wasSuccessful: true })}
                                                className="w-4 h-4"
                                            />
                                            <span className="text-green-700 font-semibold">✅ 完了・成功</span>
                                        </label>
                                        <label className="flex items-center space-x-2 cursor-pointer">
                                            <input
                                                type="radio"
                                                name="wasSuccessful"
                                                checked={formData.wasSuccessful === false}
                                                onChange={() => setFormData({ ...formData, wasSuccessful: false })}
                                                className="w-4 h-4"
                                            />
                                            <span className="text-gray-700 font-semibold">💪 途中・挑戦中</span>
                                        </label>
                                    </div>
                                </div>

                                {/* 詳細メモ */}
                                <div>
                                    <label className="block text-sm font-bold text-gray-800 mb-2">感想や詳細（任意）</label>
                                    <textarea
                                        value={formData.details}
                                        onChange={(e) => setFormData({ ...formData, details: e.target.value })}
                                        placeholder="どんなことが大変でしたか？どう乗り越えましたか？"
                                        rows={4}
                                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-grit-primary focus:outline-none transition-colors resize-none"
                                    />
                                </div>

                                {/* ボタン */}
                                <button
                                    type="submit"
                                    className="w-full btn-grit text-white px-6 py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center space-x-2"
                                >
                                    <span className="text-xl">💾</span>
                                    <span>記録を保存</span>
                                </button>
                            </form>

                            {/* 励ましメッセージ */}
                            <div className="mt-8 bg-white/95 backdrop-blur-sm p-6 rounded-2xl shadow-2xl text-center">
                                <div className="text-3xl mb-4">🌟</div>
                                <h3 className="text-lg font-bold text-gray-800 mb-2">小さな粘りも大きな成長の種！</h3>
                                <p className="text-gray-700">
                                    どんなに小さな努力でも記録することで、あなたの成長が見える化されます。継続こそが最大の力です！
                                </p>
                            </div>
                        </div>
                    </div>
                );
            };

            // 週次振り返りコンポーネント
            const WeeklyReview = () => {
                const today = new Date();
                const thisWeekStart = getWeekStartDate(today);
                const thisWeekEnd = getWeekEndDate(today);
                
                const thisWeekLogs = React.useMemo(() => {
                    return getLogsForWeek(gritLogs, thisWeekStart)
                        .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
                }, [gritLogs, thisWeekStart]);

                const existingReview = getWeeklyReview(thisWeekStart);

                const [selectedBestLogs, setSelectedBestLogs] = React.useState(existingReview?.bestOfWeek || []);
                const [reflections, setReflections] = React.useState({
                    emotions: existingReview?.reflections.emotions || '',
                    results: existingReview?.reflections.results || '',
                    messageToSelf: existingReview?.reflections.messageToSelf || '',
                });

                const toggleBestLog = (logId) => {
                    setSelectedBestLogs(prev => {
                        if (prev.includes(logId)) {
                            return prev.filter(id => id !== logId);
                        } else if (prev.length < 3) {
                            return [...prev, logId];
                        } else {
                            return [prev[1], prev[2], logId];
                        }
                    });
                };

                const handleSave = () => {
                    if (reflections.emotions.trim() && reflections.results.trim() && reflections.messageToSelf.trim()) {
                        saveWeeklyReview({
                            weekStartDate: thisWeekStart,
                            weekEndDate: thisWeekEnd,
                            bestOfWeek: selectedBestLogs,
                            reflections,
                        });
                        alert('週次振り返りを保存しました！🎉 お疲れさまでした！');
                    } else {
                        alert('すべての振り返り項目を入力してください。');
                    }
                };

                const weekStats = React.useMemo(() => {
                    const totalScore = thisWeekLogs.reduce((sum, log) => sum + log.enduranceScore, 0);
                    const totalTime = thisWeekLogs.reduce((sum, log) => sum + log.enduredTime, 0);
                    const avgDifficulty = thisWeekLogs.length > 0 
                        ? thisWeekLogs.reduce((sum, log) => sum + log.difficultyScore, 0) / thisWeekLogs.length 
                        : 0;
                    
                    return { totalScore, totalTime, avgDifficulty: Math.round(avgDifficulty * 10) / 10 };
                }, [thisWeekLogs]);

                return (
                    <div className="bg-grit-gradient p-8 min-h-screen">
                        <div className="max-w-6xl mx-auto space-y-8">
                            {/* ヘッダー */}
                            <div className="text-center py-8">
                                <div className="text-6xl mb-4">📋</div>
                                <h1 className="text-4xl font-bold text-grit-gradient mb-3 drop-shadow-lg">週次振り返り</h1>
                                <p className="text-gray-600 text-lg mb-4">{thisWeekStart} 〜 {thisWeekEnd}</p>
                                <p className="text-gray-600">この週の「粘り」を振り返り、成長を実感しましょう</p>
                            </div>

                            {/* 今週の統計 */}
                            <div className="bg-white/95 backdrop-blur-sm p-8 rounded-2xl shadow-2xl">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                                    <span className="mr-3">📊</span>今週の成果
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                                    <div className="text-center bg-white p-6 rounded-xl shadow">
                                        <div className="text-3xl font-bold text-grit-primary">{thisWeekLogs.length}</div>
                                        <div className="text-sm text-gray-700 font-medium">記録数</div>
                                    </div>
                                    <div className="text-center bg-white p-6 rounded-xl shadow">
                                        <div className="text-3xl font-bold text-grit-secondary">{weekStats.totalScore}</div>
                                        <div className="text-sm text-gray-700 font-medium">合計耐久スコア</div>
                                    </div>
                                    <div className="text-center bg-white p-6 rounded-xl shadow">
                                        <div className="text-3xl font-bold text-grit-primary">{formatTimeFromMinutes(weekStats.totalTime)}</div>
                                        <div className="text-sm text-gray-700 font-medium">合計粘り時間</div>
                                    </div>
                                    <div className="text-center bg-white p-6 rounded-xl shadow">
                                        <div className="text-3xl font-bold text-grit-secondary">{weekStats.avgDifficulty}</div>
                                        <div className="text-sm text-gray-700 font-medium">平均苦しさ</div>
                                    </div>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                {/* 左カラム: ログ一覧とベスト3選択 */}
                                <div className="bg-white/95 backdrop-blur-sm p-8 rounded-2xl shadow-2xl">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                                        <span className="mr-3">📅</span>今週の記録一覧
                                    </h2>
                                    
                                    {thisWeekLogs.length === 0 ? (
                                        <div className="text-center py-12 text-gray-600">
                                            <div className="text-4xl mb-4">📝</div>
                                            <p className="text-lg font-semibold mb-2">今週はまだ記録がありません</p>
                                            <p className="text-sm">記録を作成してから振り返りを行いましょう！</p>
                                        </div>
                                    ) : (
                                        <div className="space-y-4">
                                            {thisWeekLogs.map((log) => (
                                                <div 
                                                    key={log.id}
                                                    onClick={() => toggleBestLog(log.id)}
                                                    className={`border-2 rounded-xl p-6 cursor-pointer transition-all hover:shadow-lg ${
                                                        selectedBestLogs.includes(log.id)
                                                            ? 'border-grit-primary bg-green-50'
                                                            : 'border-gray-200 hover:border-grit-primary bg-white'
                                                    }`}
                                                >
                                                    <div className="flex justify-between items-start">
                                                        <div className="flex-1">
                                                            <div className="flex items-center gap-3 mb-3">
                                                                <div className={`w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold text-sm ${
                                                                    selectedBestLogs.includes(log.id)
                                                                        ? 'border-grit-primary bg-grit-primary text-white'
                                                                        : 'border-gray-300 text-gray-500'
                                                                }`}>
                                                                    {selectedBestLogs.includes(log.id) ? (
                                                                        selectedBestLogs.indexOf(log.id) + 1
                                                                    ) : (
                                                                        '+'
                                                                    )}
                                                                </div>
                                                                <h3 className="font-bold text-gray-800 text-lg">{log.taskName}</h3>
                                                            </div>
                                                            
                                                            <div className="flex items-center space-x-6 text-sm text-gray-600 mb-3 ml-11">
                                                                <span>📅 {log.date}</span>
                                                                <span>⏱️ {formatTimeFromMinutes(log.enduredTime)}</span>
                                                                <span className="bg-green-100 text-green-700 px-3 py-1 rounded-full font-semibold">
                                                                    苦しさ: {log.difficultyScore}/10
                                                                </span>
                                                                {log.wasSuccessful !== undefined && (
                                                                    <span className={`px-3 py-1 rounded-full font-semibold text-sm ${
                                                                        log.wasSuccessful ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'
                                                                    }`}>
                                                                        {log.wasSuccessful ? '✅ 完了' : '💪 途中'}
                                                                    </span>
                                                                )}
                                                            </div>
                                                            
                                                            {log.details && (
                                                                <p className="text-sm text-gray-700 italic bg-blue-50 p-3 rounded-lg ml-11">
                                                                    "{log.details}"
                                                                </p>
                                                            )}
                                                        </div>
                                                        <div className="bg-gradient-to-br from-green-500 to-gray-800 text-white w-16 h-16 rounded-xl flex items-center justify-center shadow-lg ml-4">
                                                            <div className="text-center">
                                                                <div className="text-lg font-bold">{log.enduranceScore}</div>
                                                                <div className="text-xs opacity-90">pt</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    
                                    {thisWeekLogs.length > 0 && (
                                        <div className="mt-6 p-4 bg-green-50 border border-green-200 rounded-xl">
                                            <div className="flex items-center text-sm text-gray-800">
                                                <span className="mr-2">⭐</span>
                                                <span className="font-semibold">
                                                    今週のベスト粘りTOP3を選択してください ({selectedBestLogs.length}/3)
                                                </span>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* 右カラム: 振り返り質問 */}
                                <div className="bg-white/95 backdrop-blur-sm p-8 rounded-2xl shadow-2xl">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-8 flex items-center">
                                        <span className="mr-3">⭐</span>振り返りの問い
                                    </h2>
                                    
                                    <div className="space-y-8">
                                        {/* 質問1 */}
                                        <div>
                                            <label className="block text-sm font-bold text-gray-800 mb-3">
                                                💭 今週、どんな感情と闘ったか？
                                            </label>
                                            <textarea
                                                value={reflections.emotions}
                                                onChange={(e) => setReflections({ ...reflections, emotions: e.target.value })}
                                                placeholder="不安、焦り、諦めたい気持ち、面倒くささなど、どんな感情と向き合いましたか？"
                                                rows={4}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-grit-primary focus:outline-none transition-colors"
                                            />
                                        </div>

                                        {/* 質問2 */}
                                        <div>
                                            <label className="block text-sm font-bold text-gray-800 mb-3">
                                                🌱 粘った後、どんなことが起きたか？
                                            </label>
                                            <textarea
                                                value={reflections.results}
                                                onChange={(e) => setReflections({ ...reflections, results: e.target.value })}
                                                placeholder="成長の実感、達成感、新しい発見、周囲の反応など、粘った結果どんな変化がありましたか？"
                                                rows={4}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-grit-primary focus:outline-none transition-colors"
                                            />
                                        </div>

                                        {/* 質問3 */}
                                        <div>
                                            <label className="block text-sm font-bold text-gray-800 mb-3">
                                                🎯 「粘った過去の自分」に、今どう言いたいか？
                                            </label>
                                            <textarea
                                                value={reflections.messageToSelf}
                                                onChange={(e) => setReflections({ ...reflections, messageToSelf: e.target.value })}
                                                placeholder="頑張った自分に対する感謝、励まし、アドバイスなど、どんな言葉をかけたいですか？"
                                                rows={4}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-grit-primary focus:outline-none transition-colors"
                                            />
                                        </div>

                                        {/* 保存ボタン */}
                                        <button
                                            onClick={handleSave}
                                            disabled={thisWeekLogs.length === 0}
                                            className="w-full btn-grit text-white font-bold py-4 px-8 rounded-xl shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"
                                        >
                                            <span className="text-xl">💾</span>
                                            <span>振り返りを保存する</span>
                                        </button>

                                        {existingReview && (
                                            <div className="text-center p-4 bg-green-50 rounded-xl border border-green-200">
                                                <p className="text-sm text-green-700 font-semibold">
                                                    ✅ この週の振り返りは保存済みです
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>

                            {/* 励ましメッセージ */}
                            <div className="bg-white/95 backdrop-blur-sm p-8 rounded-2xl text-center shadow-2xl">
                                <div className="text-4xl mb-6">✨</div>
                                <h3 className="text-2xl font-bold text-gray-800 mb-4">振り返りは成長への第一歩</h3>
                                <p className="text-gray-700 text-lg leading-relaxed">
                                    過去の自分の努力を認め、感謝することで、未来への原動力が生まれます。
                                    毎週の小さな振り返りが、大きな成長につながっていきます。
                                </p>
                            </div>
                        </div>
                    </div>
                );
            };

            // ご褒美設定コンポーネント
            const RewardSettings = () => {
                const [newReward, setNewReward] = React.useState({
                    targetScore: '',
                    rewardContent: '',
                });

                const [editingId, setEditingId] = React.useState(null);
                const [editForm, setEditForm] = React.useState({
                    targetScore: '',
                    rewardContent: '',
                });

                const cumulativeScore = getCumulativeTotalScore();

                const handleAddReward = (e) => {
                    e.preventDefault();
                    
                    const targetScore = parseInt(newReward.targetScore);
                    if (!targetScore || targetScore <= 0 || !newReward.rewardContent.trim()) {
                        alert('目標スコアとご褒美内容を正しく入力してください！');
                        return;
                    }

                    const existingScores = rewardSettings.map(r => r.targetScore);
                    if (existingScores.includes(targetScore)) {
                        alert('同じ目標スコアのご褒美が既に存在します！');
                        return;
                    }

                    addRewardSetting({
                        targetScore,
                        rewardContent: newReward.rewardContent.trim(),
                    });

                    setNewReward({ targetScore: '', rewardContent: '' });
                    alert('ご褒美を追加しました！🎉 目標に向かって頑張りましょう！');
                };

                const handleStartEdit = (reward) => {
                    setEditingId(reward.id);
                    setEditForm({
                        targetScore: reward.targetScore.toString(),
                        rewardContent: reward.rewardContent,
                    });
                };

                const handleSaveEdit = () => {
                    if (!editingId) return;
                    
                    const targetScore = parseInt(editForm.targetScore);
                    if (!targetScore || targetScore <= 0 || !editForm.rewardContent.trim()) {
                        alert('目標スコアとご褒美内容を正しく入力してください！');
                        return;
                    }

                    updateRewardSetting(editingId, {
                        targetScore,
                        rewardContent: editForm.rewardContent.trim(),
                    });

                    setEditingId(null);
                    setEditForm({ targetScore: '', rewardContent: '' });
                    alert('ご褒美を更新しました！✨');
                };

                const handleCancelEdit = () => {
                    setEditingId(null);
                    setEditForm({ targetScore: '', rewardContent: '' });
                };

                const handleDelete = (id, rewardContent) => {
                    if (window.confirm(`「${rewardContent}」を削除しますか？`)) {
                        deleteRewardSetting(id);
                        alert('ご褒美を削除しました。');
                    }
                };

                const sortedRewards = [...rewardSettings].sort((a, b) => {
                    if (a.isCompleted && !b.isCompleted) return 1;
                    if (!a.isCompleted && b.isCompleted) return -1;
                    return a.targetScore - b.targetScore;
                });

                return (
                    <div className="bg-grit-gradient p-8 min-h-screen">
                        <div className="max-w-6xl mx-auto space-y-8">
                            {/* ヘッダー */}
                            <div className="text-center py-8">
                                <div className="text-6xl mb-4">🎁</div>
                                <h1 className="text-4xl font-bold text-grit-gradient mb-3 drop-shadow-lg">ご褒美設定</h1>
                                <p className="text-gray-600 text-lg mb-4">
                                    「苦しさ」を「価値ある通貨」として、自分にご褒美を設定しましょう
                                </p>
                                
                                {/* 現在のスコア表示 */}
                                <div className="mt-8 bg-white/95 backdrop-blur-sm p-8 rounded-2xl shadow-2xl max-w-md mx-auto">
                                    <div className="flex items-center justify-center space-x-3 mb-2">
                                        <span className="text-2xl">🏆</span>
                                        <span className="text-lg font-semibold text-gray-800">現在のスコア</span>
                                    </div>
                                    <div className="text-4xl font-extrabold text-grit-primary">
                                        {cumulativeScore.toLocaleString()}<span className="text-xl text-gray-500">pt</span>
                                    </div>
                                </div>
                            </div>

                            {/* 新しいご褒美追加 */}
                            <div className="bg-white/95 backdrop-blur-sm p-8 rounded-2xl shadow-2xl">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                                    <span className="mr-3">➕</span>新しいご褒美を追加
                                </h2>
                                
                                <form onSubmit={handleAddReward} className="space-y-6">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label className="block text-sm font-bold text-gray-800 mb-2">
                                                目標スコア <span className="text-red-500">*</span>
                                            </label>
                                            <input
                                                type="number"
                                                min="1"
                                                value={newReward.targetScore}
                                                onChange={(e) => setNewReward({ ...newReward, targetScore: e.target.value })}
                                                placeholder="例：500"
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-grit-primary focus:outline-none transition-colors"
                                                required
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-bold text-gray-800 mb-2">
                                                ご褒美内容 <span className="text-red-500">*</span>
                                            </label>
                                            <input
                                                type="text"
                                                value={newReward.rewardContent}
                                                onChange={(e) => setNewReward({ ...newReward, rewardContent: e.target.value })}
                                                placeholder="例：お気に入りのスイーツを食べる"
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-grit-primary focus:outline-none transition-colors"
                                                required
                                            />
                                        </div>
                                    </div>
                                    
                                    <button
                                        type="submit"
                                        className="w-full btn-grit text-white font-bold py-4 px-8 rounded-xl shadow-lg flex items-center justify-center space-x-2"
                                    >
                                        <span className="text-xl">➕</span>
                                        <span>ご褒美を追加</span>
                                    </button>
                                </form>
                            </div>

                            {/* ご褒美一覧 */}
                            <div className="bg-white/95 backdrop-blur-sm p-8 rounded-2xl shadow-2xl">
                                <h2 className="text-2xl font-bold text-gray-800 mb-8 flex items-center">
                                    <span className="mr-3">🎁</span>設定済みのご褒美
                                </h2>

                                {sortedRewards.length === 0 ? (
                                    <div className="text-center py-12 text-gray-600">
                                        <div className="text-4xl mb-4">🎁</div>
                                        <p className="text-lg font-semibold mb-2">まだご褒美が設定されていません</p>
                                        <p className="text-sm">上のフォームから最初のご褒美を設定してみましょう！</p>
                                    </div>
                                ) : (
                                    <div className="space-y-6">
                                        {sortedRewards.map((reward) => (
                                            <div
                                                key={reward.id}
                                                className={`border-2 rounded-xl p-8 transition-all shadow-lg ${
                                                    reward.isCompleted
                                                        ? 'border-green-300 bg-green-50'
                                                        : cumulativeScore >= reward.targetScore
                                                        ? 'border-grit-primary bg-green-50 animate-pulse'
                                                        : 'border-gray-200 bg-white hover:border-grit-primary'
                                                }`}
                                            >
                                                {editingId === reward.id ? (
                                                    /* 編集モード */
                                                    <div className="space-y-6">
                                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                            <div>
                                                                <label className="block text-sm font-bold text-gray-800 mb-2">目標スコア</label>
                                                                <input
                                                                    type="number"
                                                                    min="1"
                                                                    value={editForm.targetScore}
                                                                    onChange={(e) => setEditForm({ ...editForm, targetScore: e.target.value })}
                                                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-grit-primary focus:outline-none transition-colors"
                                                                />
                                                            </div>
                                                            <div>
                                                                <label className="block text-sm font-bold text-gray-800 mb-2">ご褒美内容</label>
                                                                <input
                                                                    type="text"
                                                                    value={editForm.rewardContent}
                                                                    onChange={(e) => setEditForm({ ...editForm, rewardContent: e.target.value })}
                                                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-grit-primary focus:outline-none transition-colors"
                                                                />
                                                            </div>
                                                        </div>
                                                        <div className="flex space-x-4">
                                                            <button
                                                                onClick={handleSaveEdit}
                                                                className="bg-green-500 text-white px-6 py-3 rounded-xl hover:bg-green-600 transition-colors shadow-lg flex items-center space-x-2"
                                                            >
                                                                <span>✅</span>
                                                                <span>保存</span>
                                                            </button>
                                                            <button
                                                                onClick={handleCancelEdit}
                                                                className="bg-gray-500 text-white px-6 py-3 rounded-xl hover:bg-gray-600 transition-colors shadow-lg flex items-center space-x-2"
                                                            >
                                                                <span>❌</span>
                                                                <span>キャンセル</span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                ) : (
                                                    /* 表示モード */
                                                    <div className="flex justify-between items-start">
                                                        <div className="flex-1">
                                                            <div className="flex items-center space-x-3 mb-3">
                                                                <div className="text-3xl">
                                                                    {reward.isCompleted ? '🎉' : 
                                                                     cumulativeScore >= reward.targetScore ? '✨' : '🎁'}
                                                                </div>
                                                                
                                                                <div>
                                                                    <h3 className={`text-xl font-bold mb-1 ${
                                                                        reward.isCompleted ? 'text-green-700' : 'text-gray-800'
                                                                    }`}>
                                                                        {reward.rewardContent}
                                                                    </h3>
                                                                    <p className="text-sm text-gray-600 font-medium">
                                                                        目標: {reward.targetScore.toLocaleString()}pt
                                                                    </p>
                                                                </div>
                                                            </div>

                                                            {/* 進捗バー */}
                                                            <div className="mb-4 bg-gray-50 p-4 rounded-xl border border-gray-100">
                                                                <div className="flex justify-between text-sm text-gray-700 font-semibold mb-2">
                                                                    <span>進捗状況</span>
                                                                    <span>
                                                                        {Math.min(cumulativeScore, reward.targetScore).toLocaleString()} / {reward.targetScore.toLocaleString()}pt
                                                                    </span>
                                                                </div>
                                                                <div className="w-full bg-gray-200 rounded-full h-4">
                                                                    <div
                                                                        className={`h-4 rounded-full transition-all duration-700 ${
                                                                            reward.isCompleted || cumulativeScore >= reward.targetScore
                                                                                ? 'bg-grit-gradient'
                                                                                : 'bg-grit-gradient'
                                                                        }`}
                                                                        style={{
                                                                            width: `${Math.min((cumulativeScore / reward.targetScore) * 100, 100)}%`
                                                                        }}
                                                                    />
                                                                </div>
                                                                <div className="text-right text-sm text-gray-600 font-medium mt-2">
                                                                    {((cumulativeScore / reward.targetScore) * 100).toFixed(1)}%達成
                                                                </div>
                                                            </div>

                                                            {/* ステータス */}
                                                            {reward.isCompleted ? (
                                                                <div className="bg-green-50 p-4 rounded-xl border border-green-200">
                                                                    <div className="text-green-700 font-bold text-lg flex items-center space-x-2">
                                                                        <span>🏆</span>
                                                                        <span>達成済み！</span>
                                                                    </div>
                                                                </div>
                                                            ) : cumulativeScore >= reward.targetScore ? (
                                                                <div className="bg-green-50 p-4 rounded-xl border border-green-200">
                                                                    <div className="text-green-700 font-bold text-lg flex items-center space-x-2">
                                                                        <span>🎉</span>
                                                                        <span>おめでとうございます！ご褒美をゲットしました！</span>
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                <div className="bg-gray-50 p-4 rounded-xl border border-gray-200">
                                                                    <div className="text-gray-700 font-semibold">
                                                                        あと {(reward.targetScore - cumulativeScore).toLocaleString()}pt で達成！
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>

                                                        {/* アクションボタン */}
                                                        {!reward.isCompleted && (
                                                            <div className="flex space-x-3 ml-6">
                                                                <button
                                                                    onClick={() => handleStartEdit(reward)}
                                                                    className="text-gray-600 hover:text-gray-700 p-3 rounded-xl hover:bg-gray-50 transition-all shadow-sm hover:shadow-md"
                                                                    title="編集"
                                                                >
                                                                    <span className="text-lg">✏️</span>
                                                                </button>
                                                                <button
                                                                    onClick={() => handleDelete(reward.id, reward.rewardContent)}
                                                                    className="text-red-500 hover:text-red-700 p-3 rounded-xl hover:bg-red-50 transition-all shadow-sm hover:shadow-md"
                                                                    title="削除"
                                                                >
                                                                    <span className="text-lg">🗑️</span>
                                                                </button>
                                                            </div>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>

                            {/* ヒント */}
                            <div className="bg-white/95 backdrop-blur-sm p-8 rounded-2xl shadow-2xl">
                                <div className="text-4xl text-center mb-6">💡</div>
                                <h3 className="text-2xl font-bold text-gray-800 mb-6 text-center">
                                    ご褒美設定のコツ
                                </h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-700">
                                    <div className="bg-white p-4 rounded-xl shadow-sm">
                                        <div className="font-bold text-gray-800 mb-2 flex items-center space-x-2">
                                            <span>🎯</span>
                                            <span>現実的な目標</span>
                                        </div>
                                        <p className="text-sm">現在のスコアから見て達成可能な目標を設定しましょう</p>
                                    </div>
                                    <div className="bg-white p-4 rounded-xl shadow-sm">
                                        <div className="font-bold text-gray-800 mb-2 flex items-center space-x-2">
                                            <span>📈</span>
                                            <span>段階的な設定</span>
                                        </div>
                                        <p className="text-sm">小さなご褒美から大きなご褒美まで、複数設定すると継続しやすくなります</p>
                                    </div>
                                    <div className="bg-white p-4 rounded-xl shadow-sm">
                                        <div className="font-bold text-gray-800 mb-2 flex items-center space-x-2">
                                            <span>✨</span>
                                            <span>具体的な内容</span>
                                        </div>
                                        <p className="text-sm">「好きなものを買う」より「〇〇を食べる」「〇〇を買う」など具体的に</p>
                                    </div>
                                    <div className="bg-white p-4 rounded-xl shadow-sm">
                                        <div className="font-bold text-gray-800 mb-2 flex items-center space-x-2">
                                            <span>💪</span>
                                            <span>自分への投資</span>
                                        </div>
                                        <p className="text-sm">単なる消費だけでなく、スキルアップや健康に関するご褒美も効果的です</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // 現在のビューを表示
            const renderCurrentView = () => {
                switch (currentView) {
                    case 'dashboard':
                        return <Dashboard />;
                    case 'record':
                        return <QuickRecord />;
                    case 'review':
                        return <WeeklyReview />;
                    case 'rewards':
                        return <RewardSettings />;
                    default:
                        return <Dashboard />;
                }
            };

            return (
                <div className="min-h-screen">
                    {/* ナビゲーションヘッダー */}
                    <header className="bg-white shadow-lg sticky top-0 z-50">
                        <div className="container mx-auto px-4">
                            {/* デスクトップナビゲーション */}
                            <nav className="hidden md:flex justify-between items-center py-4">
                                {/* ロゴ */}
                                <div className="flex items-center space-x-3">
                                    <div className="text-3xl">🔥</div>
                                    <div>
                                        <h1 className="text-2xl font-bold text-grit-gradient">GritTracker</h1>
                                        <p className="text-xs text-gray-500">粘り力を可視化する</p>
                                    </div>
                                </div>

                                {/* ナビゲーション項目 */}
                                <div className="flex space-x-1 bg-gray-100 rounded-full p-1">
                                    {navigationItems.map((item) => (
                                        <button
                                            key={item.key}
                                            onClick={() => setCurrentView(item.key)}
                                            className={`flex items-center px-6 py-3 rounded-full font-medium transition-all duration-200 ${
                                                currentView === item.key
                                                    ? 'btn-grit text-white shadow-lg transform scale-105'
                                                    : 'text-gray-600 hover:text-grit-primary hover:bg-white hover:shadow-md'
                                            }`}
                                        >
                                            <span className="mr-2 text-lg">{item.icon}</span>
                                            <div className="text-left">
                                                <div className="text-sm font-semibold">{item.label}</div>
                                                <div className="text-xs opacity-75">{item.description}</div>
                                            </div>
                                        </button>
                                    ))}
                                </div>
                            </nav>

                            {/* モバイルナビゲーション */}
                            <div className="md:hidden">
                                <div className="flex justify-between items-center py-4">
                                    {/* モバイルロゴ */}
                                    <div className="flex items-center space-x-2">
                                        <div className="text-2xl">🔥</div>
                                        <h1 className="text-xl font-bold text-grit-gradient">GritTracker</h1>
                                    </div>

                                    {/* モバイルメニューボタン */}
                                    <button
                                        onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
                                        className="p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors"
                                    >
                                        <span className="text-xl">☰</span>
                                    </button>
                                </div>

                                {/* モバイルメニュー */}
                                {isMobileMenuOpen && (
                                    <div className="border-t border-gray-200 py-4">
                                        <div className="grid grid-cols-2 gap-2">
                                            {navigationItems.map((item) => (
                                                <button
                                                    key={item.key}
                                                    onClick={() => {
                                                        setCurrentView(item.key);
                                                        setIsMobileMenuOpen(false);
                                                    }}
                                                    className={`flex flex-col items-center p-4 rounded-xl font-medium transition-all ${
                                                        currentView === item.key
                                                            ? 'btn-grit text-white shadow-lg'
                                                            : 'text-gray-600 hover:bg-gray-100'
                                                    }`}
                                                >
                                                    <span className="text-xl mb-2">{item.icon}</span>
                                                    <div className="text-sm font-semibold">{item.label}</div>
                                                    <div className="text-xs opacity-75">{item.description}</div>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </header>

                    {/* メインコンテンツ */}
                    {renderCurrentView()}

                    {/* フッター */}
                    <footer className="bg-white border-t border-gray-200 mt-16">
                        <div className="container mx-auto px-4 py-8">
                            <div className="text-center">
                                <div className="flex justify-center items-center space-x-2 mb-2">
                                    <div className="text-xl">🔥</div>
                                    <span className="font-bold text-grit-gradient">GritTracker</span>
                                </div>
                                <p className="text-gray-600 text-sm mb-4">
                                    苦しさを成長の証に変える。あなたの粘り力を可視化し、セルフイメージを向上させましょう。
                                </p>
                                <div className="flex justify-center space-x-6 text-sm text-gray-500">
                                    <span>💪 粘り力向上</span>
                                    <span>📈 成長可視化</span>
                                    <span>🎯 目標達成</span>
                                    <span>🎉 自己肯定感UP</span>
                                </div>
                                <div className="mt-4 text-center text-gray-500 text-sm">
                                    🎨 緑・黒系統の配色と白から緑の背景<br/>
                                    💾 データはブラウザに保存されます ({gritLogs.length}件記録済)
                                </div>
                            </div>
                        </div>
                    </footer>

                    {/* フローティングアクションボタン (モバイル) */}
                    <div className="md:hidden fixed bottom-6 right-6 z-40">
                        <button
                            onClick={() => setCurrentView('record')}
                            className={`w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-all duration-200 transform ${
                                currentView === 'record' 
                                    ? 'bg-gray-400 scale-95' 
                                    : 'btn-grit hover:scale-110'
                            } text-white`}
                        >
                            <span className="text-xl">✏️</span>
                        </button>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>